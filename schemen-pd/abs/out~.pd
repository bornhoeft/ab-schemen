#N canvas 803 168 184 244 10;
#X obj 27 197 outlet~;
#N canvas 872 420 504 477 vu-meter 0;
#X obj 162 277 abs~;
#X obj 162 327 snapshot~;
#X obj 162 364 rmstodb;
#X obj 162 385 - 100;
#X obj 162 443 outlet;
#X obj 228 247 expr 1000 / $f1;
#X floatatom 228 275 5 0 0 1 Hz - - 0;
#X obj 162 299 slop~ 0 0 0 0 1e+09;
#X floatatom 228 222 5 0 0 0 - - - 0;
#X text 328 247 convert to hz;
#X text 262 222 peak decay time in ms;
#X obj 27 263 t f b;
#X text 286 275 The slop~ object is used here for peak detection. We need to convert the output to dB with rmstodb and also subtract by 100 to convert it to dBFS., f 31;
#X text 287 342 Copy from PD documentation;
#X obj 109 16 loadbang;
#X floatatom 70 211 5 0 0 0 - - - 0;
#X obj 70 182 max;
#X msg 83 124 0;
#X obj 27 328 - 100;
#X obj 70 238 - 100;
#X obj 27 159 env~ 1024;
#X obj 27 419 pack f f;
#X obj 27 445 outlet;
#X obj 27 54 inlet~;
#X obj 83 101 metro \$1;
#X msg 228 193 500;
#X obj 109 39 t b b b;
#X text 284 426 (c) 2023 AChim Bornhoeft;
#N canvas 535 70 763 564 peak-meter 0;
#X floatatom 217 132 5 0 50 0 - \$0-decay-speed-init - 0;
#N canvas 392 300 639 450 generate-test 0;
#X obj 45 196 osc~ 440;
#X msg 98 166 -0.25;
#X obj 165 239 *~;
#X obj 147 270 *~;
#X obj 147 395 outlet~;
#X obj 165 153 f;
#X msg 165 178 1 \, 0 \$1;
#X obj 338 87 loadbang;
#X obj 383 157 s \$0-decay-speed-init;
#X msg 338 127 30;
#X obj 97 78 metro 500;
#X obj 97 25 inlet;
#X msg 383 127 500;
#X obj 183 25 inlet;
#X obj 165 204 line~;
#X obj 338 187 s \$0-pulse-length-init;
#X obj 253 25 inlet;
#X obj 253 243 pow 4;
#X obj 253 294 line~;
#X msg 253 268 \$1 10;
#X obj 235 321 *~;
#X obj 235 352 dac~;
#X connect 0 0 3 0;
#X connect 1 0 0 1;
#X connect 2 0 3 1;
#X connect 3 0 4 0;
#X connect 3 0 20 0;
#X connect 5 0 6 0;
#X connect 6 0 14 0;
#X connect 7 0 9 0;
#X connect 7 0 12 0;
#X connect 9 0 15 0;
#X connect 10 0 5 0;
#X connect 10 0 1 0;
#X connect 11 0 10 0;
#X connect 12 0 8 0;
#X connect 13 0 5 1;
#X connect 14 0 2 0;
#X connect 14 0 2 1;
#X connect 16 0 17 0;
#X connect 17 0 19 0;
#X connect 18 0 20 1;
#X connect 19 0 18 0;
#X connect 20 0 21 0;
#X connect 20 0 21 1;
#X restore 47 101 pd generate-test;
#X text 365 155 Envelope follower for use in peak metering;
#X text 314 467 See the HTML documentation (link on main page of this patch) for more details., f 54;
#X floatatom 101 63 5 1 100 2 pulse-length \$0-pulse-length-init - 0;
#X obj 47 214 env~ 1024;
#X obj 139 183 abs~;
#X obj 139 248 snapshot~;
#X obj 139 281 rmstodb;
#X obj 127 347 vu 18 160 empty VU -20 20 0 12 #404040 #000000 1 0;
#X obj 139 213 slop~ 0 0 0 0 1e+09;
#X obj 47 248 t f b;
#X obj 47 289 - 100;
#X obj 139 306 - 100;
#X obj 47 24 tgl 19 0 empty empty empty 17 7 0 10 #dcdcdc #000000 #000000 0 1;
#X obj 217 156 expr 1000 / $f1;
#X text 197 132 ms;
#X text 215 109 decay speed;
#X floatatom 217 182 5 0 0 0 - - - 0;
#X text 197 183 hz;
#X obj 159 72 hsl 128 19 0 1 0 0 empty empty empty 32 9 0 12 #dcdcdc #000000 #000000 0 1;
#X text 314 204 A slew limiter can be used as a fast-rising envelope follower \, useful for example in peak metering. In this example a short burst of sound is metered using both the [env~] follower (which measures an average over a time window) and a fast-rising envelope follower consisting of an [abs~] object (to rectify the signal) followed by a [slop~] object set to rise quickly (1e09 asymptotic rise speed \, 0 up-slew needed to engage it) and with controllable decay (asymptotic downward speed controlled by a number box). There is no linear region at all so the linear cutoff frequency has no effect., f 54;
#X text 314 368 The output is sampled using a [snapshot~] object. Both envelope followers are converted to dBFS for the IEM VU meter., f 54;
#X text 314 420 When the pulse is very short (1 msec \, for instance) the RMS meter acts badly but the [slop~]-driven one still shows the peak., f 54;
#X text 198 73 Volume;
#X text 71 23 <- turn on test pulse;
#X text 35 421 see also ->;
#X connect 0 0 15 0;
#X connect 1 0 5 0;
#X connect 1 0 6 0;
#X connect 4 0 1 1;
#X connect 5 0 11 0;
#X connect 6 0 10 0;
#X connect 7 0 8 0;
#X connect 8 0 13 0;
#X connect 10 0 7 0;
#X connect 11 0 12 0;
#X connect 11 1 7 0;
#X connect 12 0 9 0;
#X connect 13 0 9 1;
#X connect 14 0 1 0;
#X connect 15 0 18 0;
#X connect 18 0 10 3;
#X connect 20 0 1 2;
#X restore 288 362 pd peak-meter;
#X msg 128 75 4000;
#X connect 0 0 7 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 5 0 6 0;
#X connect 6 0 7 3;
#X connect 7 0 1 0;
#X connect 8 0 5 0;
#X connect 11 0 18 0;
#X connect 11 1 1 0;
#X connect 14 0 26 0;
#X connect 15 0 16 1;
#X connect 15 0 19 0;
#X connect 16 0 15 0;
#X connect 17 0 16 1;
#X connect 18 0 21 0;
#X connect 19 0 21 1;
#X connect 20 0 16 0;
#X connect 20 0 11 0;
#X connect 21 0 22 0;
#X connect 23 0 20 0;
#X connect 23 0 0 0;
#X connect 24 0 17 0;
#X connect 25 0 8 0;
#X connect 26 0 24 0;
#X connect 26 1 29 0;
#X connect 26 2 25 0;
#X connect 29 0 24 1;
#X restore 83 172 pd vu-meter;
#X obj 25 21 catch~ \$1-out;
#X obj 83 199 s \$1-spat-vu;
#X obj 46 73 r mute;
#X obj 25 99 *~ 1;
#X connect 1 0 3 0;
#X connect 2 0 5 0;
#X connect 4 0 5 1;
#X connect 5 0 1 0;
#X connect 5 0 0 0;
